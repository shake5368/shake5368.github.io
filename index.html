<!DOCTYPE html>
<html>
<head>
  <title>即時語音問答</title>
  <style>
    #chatbox {
      display: flex;
      flex-direction: column;
      height: 300px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      padding: 10px;
    }
    .message {
      margin-bottom: 10px;
    }
    .user-message {
      text-align: right;
    }
    .bot-message {
      text-align: left;
    }
  </style>
</head>
<body>
  <div id="chatbox"></div>
  <button id="recordBtn">錄音</button>

  <script>
    const chatbox = document.getElementById('chatbox');
    const recordBtn = document.getElementById('recordBtn');

    let mediaRecorder;

    recordBtn.addEventListener('click', async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      const chunks = [];

      mediaRecorder.ondataavailable = e => chunks.push(e.data);

      mediaRecorder.onstop = async () => {
        const blob = new Blob(chunks, { type: 'audio/webm; codecs=opus' });
        const reader = new FileReader();
        reader.onloadend = async () => {
          const base64Audio = reader.result;
          const message = await processAudio(base64Audio); // 假设你有一个处理音频的函数
          displayMessage('user', base64Audio, message);
        };
        reader.readAsDataURL(blob);
      };

      mediaRecorder.start();
      recordBtn.textContent = '停止錄音';
      recordBtn.onclick = () => {
        mediaRecorder.stop();
        recordBtn.textContent = '錄音';
        recordBtn.onclick = recordBtn.onclick; // 重置 onclick 事件
      };
    });

    function displayMessage(role, audioData, text = '') {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message', `${role}-message`);

      const audio = document.createElement('audio');
      audio.controls = true;
      audio.src = audioData;
      messageDiv.appendChild(audio);

      if (text) {
        const textSpan = document.createElement('span');
        textSpan.textContent = text;
        messageDiv.appendChild(textSpan);
      }

      chatbox.appendChild(messageDiv);
      chatbox.scrollTop = chatbox.scrollHeight; // 自動滾動到底部
    }

    async function processAudio(base64Audio) {
      // 在這裡添加你的語音處理邏輯，例如發送到後端 API 進行語音轉文字
      // 然後返回處理後的文字訊息
      return '（這裡是語音轉文字的結果）'; // 範例
    }
  </script>
</body>
</html>
