<!DOCTYPE html>
<html>
<head>
  <title>MediaRecorder 錄音示例</title>
  <style>
    #recordings {
      display: flex;
      flex-wrap: wrap;
    }

    .audio-container {
      margin: 5px;
    }
  </style>
</head>
<body>
  <button id="startBtn">開始錄音</button>
  <button id="stopBtn" disabled>停止錄音</button>
  <div id="recordings"></div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const recordingsDiv = document.getElementById('recordings');

    let mediaRecorder;
    let startTime = 0;

    startBtn.addEventListener('click', async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = e => {
      const blob = new Blob([e.data], { type: 'audio/webm; codecs=opus' });
      const audioUrl = URL.createObjectURL(blob);
    
      const audio = document.createElement('audio');
      audio.controls = true;
      audio.src = audioUrl;
    
      // 将 blob 对象存储在 audio 元素的 dataset 中
      audio.dataset.blob = blob;
    
      // 在 audio 元素播放完毕后释放 blob 对象
      audio.onended = () => {
        URL.revokeObjectURL(audio.src);
        audio.dataset.blob = null; // 释放 blob 对象
      };

  const timeElapsed = Date.now() - startTime;
  audio.dataset.startTime = timeElapsed / 1000;

  // 显示片段时长
  audio.onloadedmetadata = () => {
    const durationSpan = document.createElement('span');
    durationSpan.textContent = ` (${audio.duration.toFixed(2)}s)`;
    container.appendChild(durationSpan);
  };

  const container = document.createElement('div');
  container.classList.add('audio-container');
  container.appendChild(audio);
  recordingsDiv.appendChild(container);
};

      mediaRecorder.start(4000);
      startTime = Date.now();

      startBtn.disabled = true;
      stopBtn.disabled = false;
    });

    stopBtn.addEventListener('click', () => {
      mediaRecorder.stop();
      startBtn.disabled = false;
      stopBtn.disabled = true;
    });
  </script>
</body>
</html>
