<!DOCTYPE html>
<html>
<head>
  <title>MediaRecorder 錄音示例</title>
  <style>
    #recordings {
      display: flex;
      flex-wrap: wrap;
    }
    .audio-container {
      margin: 5px;
    }
  </style>
</head>
<body>
  <button id="startBtn">開始錄音</button>
  <button id="stopBtn" disabled>停止錄音</button>
  <div id="recordings"></div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const recordingsDiv = document.getElementById('recordings');

    let mediaRecorder;
    let startTime = 0;

    startBtn.addEventListener('click', async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = e => {
        const reader = new FileReader();
        reader.onloadend = () => {
          const base64Audio = reader.result; // 音频数据转换为 Base64

          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = base64Audio; // 使用 Base64 数据作为 src

          const timeElapsed = Date.now() - startTime;
          audio.dataset.startTime = timeElapsed / 1000;

          audio.onloadedmetadata = () => {
            const durationSpan = document.createElement('span');
            durationSpan.textContent = ` (${audio.duration.toFixed(2)}s)`;
            container.appendChild(durationSpan);
          };

          const container = document.createElement('div');
          container.classList.add('audio-container');
          container.appendChild(audio);
          recordingsDiv.appendChild(container);
        };
        reader.readAsDataURL(e.data); // 读取 Blob 数据并转换为 Base64
      };

      mediaRecorder.start(4000);
      startTime = Date.now();

      startBtn.disabled = true;
      stopBtn.disabled = false;
    });

    stopBtn.addEventListener('click', () => {
      mediaRecorder.stop();
      startBtn.disabled = false;
      stopBtn.disabled = true;
    });
  </script>
</body>
</html>
