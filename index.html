<!DOCTYPE html>
<html>
<head>
  <title>MediaRecorder 錄音示例</title>
  <style>
    #recordings {
      display: flex;
      flex-wrap: wrap;
    }
    .audio-container {
      margin: 5px;
    }
  </style>
</head>
<body>
  <button id="startBtn">開始錄音</button>
  <button id="stopBtn" disabled>停止錄音</button>
  <div id="recordings"></div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const recordingsDiv = document.getElementById('recordings');

    let mediaRecorder;
    let startTime = 0;

    startBtn.addEventListener('click', async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = e => {
        const reader = new FileReader();
        reader.onloadend = () => {
          const base64Audio = reader.result;
          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = base64Audio;
          audio.dataset.blob = blob; // 將 blob 存儲在 audio 的 dataset 中

        audio.onloadedmetadata = () => {
          const durationSpan = document.createElement('span');
          durationSpan.textContent = ` (${audio.duration.toFixed(2)}s)`;
          container.appendChild(durationSpan);
        };

        audio.onended = () => {
          URL.revokeObjectURL(audio.src);
          audio.dataset.blob = null; // 釋放 blob
        };

        const container = document.createElement('div');
        container.classList.add('audio-container');
        container.appendChild(audio);
        recordingsDiv.appendChild(container);
      };

      mediaRecorder.start(4000);
      startTime = Date.now();

      startBtn.disabled = true;
      stopBtn.disabled = false;
        reader.readAsDataURL(e.data);
    });

    stopBtn.addEventListener('click', () => {
      mediaRecorder.stop();
      startBtn.disabled = false;
      stopBtn.disabled = true;
    });
  </script>
</body>
</html>
